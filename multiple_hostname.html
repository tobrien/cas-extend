





<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Supporting Multiple Host Names</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
  </head>
  <body class="composite">
    <div id="banner">
                          <a href="http://www.discursive.com/projects/cas-extend/" id="bannerLeft">
    
                                    <img src="http://www.discursive.com/projects/cas-extend/images/cas-banner.png" alt="" />
    
            </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">Last Published: Sun Apr 30 13:41:08 CDT 2006</div>
      <div class="xright">  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn"><div id="navcolumn">      <h5>Extended CAS</h5>
    <ul>
              
    <li class="none">
          <a href="index.html">Introduction</a>
        </li>
              
    <li class="none">
          <a href="configure.html">Configuration</a>
        </li>
              
    <li class="none">
          <a href="download.html">Download</a>
        </li>
              
    <li class="none">
          <a href="release_notes.html">Release Notes</a>
        </li>
          </ul>
      <h5>Using CAS: HOW-TO</h5>
    <ul>
              
    <li class="none">
          <a href="tomcat_jndi.html">Config via JNDI</a>
        </li>
              
    <li class="none">
          <a href="dummy_trust.html">Dummy Trust</a>
        </li>
              
    <li class="none">
          <strong><a href="multiple_hostname.html">Multiple Host Names</a></strong>
        </li>
          </ul>
      <h5>Project Collaboration</h5>
    <ul>
              
    <li class="none">
          <a href="google_group.html">Google Group</a>
        </li>
              
    <li class="none">
          <a href="source-repository.html">Source Code (SVN)</a>
        </li>
              
    <li class="none">
          <a href="team-list.html">Develoment Team</a>
        </li>
              
    <li class="none">
          <a href="license.html">License</a>
        </li>
          </ul>
  <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy">
              <img alt="Built by Maven" src="./images/logos/maven-feather.png"></img>
            </a>
    </div></div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Supporting Multiple Host Names</h2><p>This document outlines the Extended CAS Filter's option to support multiple host names. The use of this configuration parameter introduces the potential for a vulnerability as the Host: header is generated by a client. Trusting the Host: header and passing it along to the CAS server introduces the potential for system compromise through the use of a forged Host: header and a valid ticket obtained from an application that validates tickets against the same CAS server. Read more for an explanation of when you might accept such a compromise.</p><div class="section"><h3>What is the issue?</h3><p>When you use the original CAS filter, the filter requires either a server name of a service URL configuration parameter. If you are not authenticated, the CAS filter redirects you to the login page. Once you've authenticated successfully, the CAS Server then needs to know where to redirect your browser, so the CAS server redirects you to the URL the original application supplied when you were redirected to the CAS server. The workflow is as follows:</p><ul><li>You attempt to load a page in an application with CASFilter. <i>http://www.blah.com/memberProfile.jsp</i></li><li>CASFilter notices that you are not authenticated and redirects you to the CAS Server login page. In the course of this redirection it appends a parameter to the redirection URL called <i>service</i>.</li><li>CAS Server presents you with the login page</li><li>You login successfully to the CAS Serverr and it redirects you back to the URL supplied in &quot;service&quot;<p>In the original CAS Filter, you had to supply either a <i>serverName</i> or a <i>serviceURL</i> parameter. One of these parameter is required. If you supply a <i>serviceURL</i> parameter, this is the service URL that is always sent to the CAS Server. You would use the <i>serviceURL</i> if you always want the application to end up at the same page after a successful login. If you specify the <i>serverName</i> parameter, the CASFilter will figure out what URL you were trying to hit and pass that on to the CAS Server. You would use the serverName parameter if you want to always redirect the user to the protected page they originially intended to load.</p><p>A problem arises in the original CAS filter when you have an application that might serve more than one host name. Not necessarily a virtual host, but an application that needs to be able to transparently supply single-sign-on to more than one host name. Take the following example: you have a web application that handles the host name www.discursive.com and java.discursive.com. You need to be able to support authentication such that if a user attempts to access the resource http://java.discursive.com/protected/test.jsp the host name should be preserved after a successful authentication.</p></li></ul></div><div class="section"><h3>How does Extended CAS Solve this Problem?</h3><p>This problem is solved in the Extended CAS server by making a compromise and relying on the Host: header. If you specify a list of acceptable server names in multipleServerName, the CASFilter will obtain the server name from request.getServerName() and it will attempt to match this servername against the list of names you supply. If the Host: header matches one of these host names, it will pass this host name on to the CAS Server.</p><div class="section"><h4>JNDI Configuration</h4><p>If you are configuring the CASFilter via JNDI, add a space delimited list of servers to the multipleServerName attribute of the Resource. The following Resource element is valid if you are configuring CASConfig as a GlobalNamingResource:</p><div class="source"><pre>&lt;Resource name=&quot;security/CASConfig&quot;
      type=&quot;com.discursive.cas.extend.client.CASConfig&quot;
      factory=&quot;org.apache.naming.factory.BeanFactory&quot;
      casLogin=&quot;https://www.discursive.com/cas/login&quot;
      casValidate=&quot;https://www.discursive.com/cas/serviceValidate&quot;
      dummyTrust=&quot;true&quot;
      multipleServerName=&quot;www.discursive.com java.discursive.com&quot;/&gt; </pre></div></div><div class="section"><h4>Filter Parameters</h4><p>The following filter initialization parameters suppliess the same list of servers as the previous JNDI configuration.</p><div class="source"><pre>&lt;filter&gt;
  &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;
  &lt;filter-class&gt;
    com.discursive.cas.extend.client.filter.CASFilter
  &lt;/filter-class&gt;
  // ...other init params...
  &lt;init-param&gt;
    &lt;param-name&gt;
      com.discursive.cas.extend.client.filter.multiServerName
    &lt;/param-name&gt;
    &lt;param-value&gt;www.discursive.com java.discursive.com&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;</pre></div></div></div><div class="section"><h3>Why is this a Vulnerability?</h3><p>The original authors of the CAS Filter explain this in detail <a href="http://www.ja-sig.org/wiki/display/CAS/CASFilter">here</a>. In summary, relying on the Host header would allow for an &quot;illicit proxy&quot;, if you have two applications X and Y that both rely on the Host header, you could authenticate successfuly to application Y, and then send a forged header to Y with a Host of X effectively authenticating to application X by using Y as a proxy. In other words, if you blindly trust the Host header you open up your system to attacks that would allow someone to authenticate to all applications that use a particular CAS filter. Blindly trusting a Host header creates a situation where a crafty malicious client could just switch between different hosts without much trouble.</p><p>The Extended CAS filter manages this vulnerability by asking you to supply a list of server names that a particular CAS Filter can present to the server. This limits the vulnerability to a known set of hosts. But, this doesn't do away with the vulnerability, you have to know exactly what you are doing to use this multipleServerName feature in a way that doesn't introduce this vulnerability, read on.</p></div><div class="section"><h3>When is it not a Vulnerability?</h3><p>Assume that you have two applications, application A is a user-facing application that displays a different skin depending on the host name. If the host name is www.discursive.com it needs to display a standard layout, and if the host name is java.discursive.com, it needs to display a different java-centric skin. The user population for both of these hostnames is exactly the same, and the permissions are exactly the same. You could say that application A services the same user population. In this case, it doesn't matter if someone goes to the trouble of forging a Host header to use www.discursive.com as an illicit proxy to java.discursive.com as both sites cater to identical populations with identical permissions.</p><p>If you added in a third hostname admin.discursive.com that had a different set of users with a different set of administrative permissions to the same web application. You would be introducing a vulnerability. If the CASFilter could then represent one of three host names www.discursive.com, java.discursive.com, and admin.discursive.com to the CAS server, a user could authenticate to www.discursive.com, making another request to www.discursive.com forging a Host header of admin.discursive.com. Then the user could present that ticket to admin.discursive.com and gain entry to an administrative application with a completely different set of permissions.</p><p>For this system to be secure, you would need to serve the admin.discursive.com application from a different web application that explicitly specifies the serverName admin.discursive.com. You also need to make sure that the application that handles www.discursive.com and java.discurisve.com can never accept a forged Host header for admin.discursive.com.</p><div class="source"><pre>  Contributors:  Tim O'Brien (3/06)</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2006
    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
